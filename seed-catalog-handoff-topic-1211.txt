Fitness-Tracker â€” Coding Agent Handoff Prompt

Task
Implement initial seeded exercise catalog migration using yuhonas/free-exercise-db (Option A), replacing all current built-in exercise/workout seed data while preserving existing app functionality.

Repo
/home/openclaw/.openclaw/workspace/fitness-tracker/Fitness-Tracker

Branching
- Create a NEW feature branch from latest origin/main before any code changes.
- Keep commits scoped to this feature.

Decisions from Brady (locked)
1) Existing built-in workouts and exercises can be removed.
2) New seeded records MUST have stable deterministic IDs.
3) Remove legacy workout/exercise seed data.
4) Use a dedicated store for seeded catalog + metadata (preferred), not mixed into saved/custom stores.
5) Start with partial seed (about 200 entries) to validate end-to-end before full rollout.
6) Hard-remove entries when refreshing to new seedVersion if they no longer exist upstream.
7) Replace category usage throughout app with primaryMuscles-based grouping/display (where category is currently used).
8) Add explicit handling/instructions for refresh/removal behavior.

Data source + ingestion
- Vendor a pinned snapshot of free-exercise-db in-repo (NO runtime GitHub fetch).
- Add deterministic transform script/module from vendor snapshot -> app seed records.
- Include only first ~200 transformed entries for this phase (deterministic selection, e.g., sorted by source id/name then take 200).

Required seeded exercise shape (for app catalog)
- id: string (deterministic stable seed identity key)
- name: string
- description: string
- instructions: string
- image: string
- equipment: string
- category: string
- primaryMuscles: string[]
- secondaryMuscles: string[]

Normalization + fallback rules
- name: required, trim; skip record if empty.
- description: default ''.
- instructions: default ''. (stored metadata only; do not add new instructions UI)
- image: deterministic primary image string; default ''.
- equipment: normalize to app-compatible value, fallback 'Other'.
- category: normalize to app-compatible value, fallback 'Other'.
- primaryMuscles: normalize to string[], fallback [].
- secondaryMuscles: normalize to string[], fallback [].
- No extra fields in persisted seeded exercise records.

Important migration notes
- Current app references static data/exercises.ts + data/workouts.ts in multiple screens.
- Remove static legacy lists and route all exercise reads to seeded catalog store output.
- Remove legacy built-in workout seeds; app should still function with saved/custom workouts and create flows.
- Replace category-filter/display usage to use primaryMuscles-derived grouping where category was previously used.

Store architecture (implement)
Create a dedicated persisted store for seed catalog, e.g. store/exerciseCatalog.ts
State example:
- seededExercises: SeededExercise[]
- seedVersion: string | null
- seedSource: 'free-exercise-db'
- hasHydrated: boolean
- seedApplied: boolean
Actions example:
- runSeedIfNeeded()
- refreshSeedIfVersionChanged(nextVersion)
- getAllExercisesForSelection() // used by screens

Persistence behavior
- Persist via existing Zustand + AsyncStorage pattern.
- On first app open (after hydration), seed once.
- Save marker + seedVersion for idempotency.
- On seedVersion change:
  - Recompute deterministic seed list.
  - Upsert by stable id.
  - Hard-remove seeded records no longer present in current seed snapshot.
  - Preserve user-created/custom exercises untouched.

Identity + reconciliation strategy
- Build deterministic id from stable source identifier if available.
- If source id unavailable, derive deterministic hash from canonicalized fields.
- Prefix IDs clearly (e.g., seed-fedb-<stableKey>) to avoid collisions with custom IDs.

Implications of dedicated store (what and why)
- Pros:
  - Clear ownership boundary (seeded vs user-owned data).
  - Safe versioned refresh logic without risking saved/custom user records.
  - Easier rollback/testing of seed changes.
- Cons:
  - Requires touching read paths currently importing static arrays.
  - Slightly more wiring for hydration gating.
- Net: recommended and required for safe deterministic refresh.

UI/flow compatibility requirements
- Exercise lists/search in Home/Add/creation flows must read from seeded store + custom exercises where applicable.
- Seeded exercises must be selectable in existing exercise/workout creation flows.
- Do NOT add new instructions UI; metadata only.
- Ensure no crashes if image/instructions/muscles are empty.

Mapping clarifications (from Brady)
- Name -> name
- description -> description
- Previous category usage in app should transition to primaryMuscles usage for grouping/filtering.
- Do not preserve old built-in catalog/workouts.

Acceptance criteria
1) Fresh install: seeds ~200 entries once.
2) Restart/relaunch: no duplicates.
3) Exercise/workout creation flows still work with seeded catalog.
4) No runtime errors on missing image/description/instructions/muscles.
5) seedVersion persisted.
6) Version bump refresh works:
   - seeded records reconcile by deterministic id
   - removed upstream seeded records are hard-removed
   - custom exercises remain untouched
7) Category-dependent UI now uses primaryMuscles logic where category was previously referenced.

Manual QA checklist
- Fresh install first run: verify seed count ~200 and seedVersion saved.
- Restart app: verify count unchanged, no duplicates.
- Create custom exercise + save: survives restart and refresh.
- Use exercise/workout creation flows: seeded items visible/selectable.
- Simulate seedVersion bump: refresh executes, hard-removes missing seeded entries, keeps custom exercises.
- Verify app screens previously using category now behave correctly using primaryMuscles grouping.

Implementation constraints
- No runtime network fetch to GitHub.
- Keep changes scoped; avoid unrelated refactors.
- Add lightweight comments/docs for seedVersion + refresh semantics.

Deliverables
- New/updated catalog seed files + transform logic.
- Dedicated persisted exercise catalog store.
- Screen/store wiring updates to consume seeded catalog.
- Legacy seed removal.
- Brief migration notes in repo (README or DEVELOPMENT.md section).

When done
- Run lint/typecheck/build checks used by project.
- Summarize changed files, key decisions, and any follow-up risks.
